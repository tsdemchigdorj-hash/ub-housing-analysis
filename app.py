import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt

# 1. –í—ç–±–∏–π–Ω —Ç–æ—Ö–∏—Ä–≥–æ–æ
st.set_page_config(page_title="UB Housing Analysis", layout="wide")
st.title("üèôÔ∏è –£–ª–∞–∞–Ω–±–∞–∞—Ç–∞—Ä —Ö–æ—Ç—ã–Ω –æ—Ä–æ–Ω —Å—É—É—Ü–Ω—ã “Ø–Ω–∏–π–Ω –¥—ç–ª–≥—ç—Ä—ç–Ω–≥“Ø–π —à–∏–Ω–∂–∏–ª–≥—ç—ç")

# 2. –î–∞—Ç–∞ —É–Ω—à–∏—Ö —Ñ—É–Ω–∫—Ü
@st.cache_data
def load_data():
    # –§–∞–π–ª Excel —Ñ–æ—Ä–º–∞—Ç—Ç–∞–π —Ç—É–ª read_excel –∞—à–∏–≥–ª–∞–Ω–∞
    return pd.read_excel('ub_housing.csv')

try:
    df = load_data()
    
    # --- –•–≠–°–≠–ì 1: “Æ–ù–ò–ô–ù ”®–°”®–õ–¢ (–®—É–≥–∞–º–∞–Ω –≥—Ä–∞—Ñ–∏–∫) ---
    st.header("1. “Æ–Ω–∏–π–Ω –µ—Ä”©–Ω—Ö–∏–π —Ö–∞–Ω–¥–ª–∞–≥–∞")
    pivot_df = df.pivot_table(index='–°–∞—Ä', columns='–î“Ø“Ø—Ä—ç–≥', values='–£—Ç–≥–∞', aggfunc='mean')
    st.line_chart(pivot_df)

    # --- –•–≠–°–≠–ì 2: –î“Æ“Æ–†–ì“Æ“Æ–î–ò–ô–ù –•–ê–†–¨–¶–£–£–õ–ê–õ–¢ (–ë–∞–≥–∞–Ω–∞–Ω –≥—Ä–∞—Ñ–∏–∫) ---
    st.header("2. –î“Ø“Ø—Ä–≥“Ø“Ø–¥–∏–π–Ω “Ø–Ω–∏–π–Ω —Ö–∞—Ä—å—Ü—É—É–ª–∞–ª—Ç")
    # –≠–Ω–¥ —Ç–∞–Ω—ã Colab –¥—ç—ç—Ä –±–∏—á—Å—ç–Ω –¥“Ø“Ø—Ä–≥“Ø“Ø–¥–∏–π–≥ —Ö–∞—Ä—å—Ü—É—É–ª—Å–∞–Ω –∫–æ–¥—ã–≥ –æ—Ä—É—É–ª–Ω–∞
    # –ñ–∏—à—ç—ç –Ω—å: –°“Ø“Ø–ª–∏–π–Ω —Å–∞—Ä—ã–Ω “Ø–Ω–∏–π–≥ —Ö–∞—Ä—É—É–ª–∞—Ö
    last_month_data = df[df['–°–∞—Ä'] == df['–°–∞—Ä'].max()]
    st.bar_chart(data=last_month_data, x='–î“Ø“Ø—Ä—ç–≥', y='–£—Ç–≥–∞')

    # --- –•–≠–°–≠–ì 3: –î–≠–õ–ì–≠–†–≠–ù–ì“Æ–ô ”®–ì”®–ì–î”®–õ ---
    with st.expander("–ë“Ø—Ö ”©–≥”©–≥–¥–ª–∏–π–≥ —Ö“Ø—Å–Ω—ç–≥—Ç—ç—ç—Ä —Ö–∞—Ä–∞—Ö"):
        st.write(df)

except Exception as e:
    st.error(f"–ê–ª–¥–∞–∞ –≥–∞—Ä–ª–∞–∞: {e}")
